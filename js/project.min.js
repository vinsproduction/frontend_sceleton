var Models,PrototypeModel,UserModel,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};PrototypeModel=function(){function a(){}return a.prototype.get=function(a,b,c){return app.api(a,"GET",b,function(a){return c(a)})},a.prototype.post=function(a,b,c){return app.api(a,"POST",b,function(a){return c(a)})},a}(),UserModel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.getDetails=function(a,b){return this.get("api/user/details",a,function(){return function(a){return b(a)}}(this))},b}(PrototypeModel),Models=function(){function a(){this.user=new UserModel}return a}();var IndexView,PrototypeView,Views,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};PrototypeView=function(){function a(){this.varconstants={},this.init()}return a.prototype.render_debug=!0,a.prototype.generateRenders=function(a){return null==a&&(a=this.template),_.each(a,function(a){return function(b,c){return a.templateSourse||(a.templateSourse={}),a.templateSourse[c]=$.trim(b.html()),a.render||(a.render={}),a.render[c]=function(b){return null==b&&(b={}),a.doRender(c,a.template[c],a.templateSourse[c],b)},a.preRender||(a.preRender={}),a.preRender[c]=function(b){return null==b&&(b={}),a.doPreRender(c,a.template[c],b)}}}(this)),this.renderAll=function(b){return function(){return _.each(a,function(a,c){return b.render[c]()})}}(this)},a.prototype.doPreRender=function(a,b,c){var d,e,f,g,h,i;try{return d=c&&c.c?c.c:"#000",g=c&&c.t?c.t:!1,i=c&&c.w?parseInt(c.w)+"px":"auto",f=c&&c.h?parseInt(c.h)+"px":"100px",h=c&&c.m?parseInt(c.m)+"px":parseInt(f)/2-10+"px",this.render_debug&&console.log("[preRender "+a+"] loadtext:",g),g?b.html('<div class="prerender" style="position:relative;height:'+f+";width:"+i+';text-align:center;">\n	<p style="position: relative; top:'+h+"; color:"+d+'">'+g+"</p>\n</div>"):b.empty()}catch(j){return e=j,console.error("[preRender] template undefined"),console.error(e)}},a.prototype.doRender=function(a,b,c,d){switch(null==d&&(d={method:"html"}),this.render_debug&&console.log("[Render "+a+"]","| @vars:",this.vars),d.method){case"append":return b.append(Mustache.to_html(c,this.vars));case"prepend":return b.prepend(Mustache.to_html(c,this.vars));default:return b.html(Mustache.to_html(c,this.vars))}},a.prototype.init=function(){},a.prototype.controller=function(a){this.opt=null!=a?a:{}},a.prototype.actions=function(){},a.prototype.doImage=function(a,b){var c;return null==b&&(b=""),a&&""!==a?(/http:\/\//.test(a)||(a=app.root+a),c='<img src="'+a+'" class="'+b+'" >'):void 0},a}(),IndexView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.init=function(){return this.el=$("index"),this.template={example:this.el.find(".example")},this.generateRenders()},b.prototype.controller=function(a){return this.opt=null!=a?a:{},this.vars={},this.preRender.example({t:"Load...",h:130}),app.models.user.get({},function(a){return function(b){return b.error?app.errors.popup(b.error):a.renderResponse(b)}}(this))},b.prototype.renderResponse=function(a){return _.extend(this.vars,this.varconstants),_.extend(this.vars,a),this.vars.avatar&&this.doImage(this.vars.avatar),this.render.example(),this.actions()},b}(PrototypeView),Views=function(){function a(){this.index=new IndexView}return a}();var Router,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Router=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.routes={"":"index","!":"index","!index":"index","!page":"page","!page/":"page","!page/:id":"page","!page/:id/":"page","!ooops":"ooops","!ooops/":"ooops","*path":"notFound"},b.prototype.initialize=function(){return this.bind("all",function(){})},b.prototype.before=function(a){return this.route=""===a?"empty":a,app.debugBox.state&&app.debugBox.log("route",this.route),console.debug("[App > router]","route:",this.route),this.hide()},b.prototype.after=function(){},b.prototype.hide=function(){return $("body > main > .sections > section").removeClass("current").hide()},b.prototype.show=function(){return this.hide(),this.el.addClass("current").show()},b.prototype.scrollTop=function(a){return app.scroll(0,a)},b.prototype.notFound=function(a){return this.el=$("section#notFound"),this.scrollTop(),this.show(),console.error("[App > router] route "+a+" not found"),app.debugBox.state?app.debugBox.log("route","not found"):void 0},b.prototype.ooops=function(){return this.el=$("section#ooops"),this.scrollTop(),this.show()},b.prototype.index=function(){return this.el=$("section#index"),this.scrollTop(),this.show()},b.prototype.page=function(){return this.el=$("section#page"),this.scrollTop(),this.show()},b}(Backbone.Router);var App,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};App=function(){function a(a){var b;null==a&&(a={}),this.options={name:"Frontend Skeleton",hashNavigate:!1,remoteHost:"http://vinsproduction.com",root:"",box:!1,onLoad:function(){}},_.extend(this.options,a),this.name=this.options.name,this.hashNavigate=this.options.hashNavigate,this.remoteHost=this.options.remoteHost,this.root=this.options.root,this.box=this.options.box,this.onLoad=this.options.onLoad,this.console(),this.debugMode=/debug/.test(window.location.search),this.local=""===window.location.host||/localhost/.test(window.location.host),this.host=window.location.protocol+"//"+window.location.host,this.debug=function(){return function(){var a;return a=$$.urlParam("debug"),a?a.split(","):[]}}(this)(),this.local&&window.WebSocket&&(b=777,$$.includeJS("http://localhost:"+b+"/livereload.js"),console.debug("[App > Livereload] http://localhost:"+b+"/livereload.js")),this.libs(),this.init()}return a.prototype.init=function(){return $(function(a){return function(){return(__indexOf.call(a.debug,"box")>=0||a.box)&&a.debugBox.init(),a.listeners(),Models&&(a.models=new Models),Views&&(a.views=new Views),a.hashNavigate&&(a.router=new Router,Backbone.history.start()),a.social.init(),window.console.info("[App > onLoad]",a.name,"Options >",a.options," Debug >",a.debug," Browser > "+$$.browser.name+" ver. "+$$.browser.version),a.onLoad()}}(this))},a.prototype.console=function(){var a,b;return b=this,window.originalConsole=console,window.console={log:function(){},debug:function(){},warn:function(){},info:function(){},error:function(){}},a=function(){var c,d,e,f,g,h;for(f=arguments[0],c=_.rest(arguments),a="",g=0,h=c.length;h>g;g++)d=c[g],a+=_.isObject(d)?$$.jlog(d):d,a+=" ";a=_.escape(a);try{switch(f){case"log":this.log.apply(this,c);break;case"debug":this.debug.apply(this,c);break;case"warn":this.warn.apply(this,c);break;case"info":this.info.apply(this,c);break;case"error":this.error.apply(this,c)}}catch(i){switch(e=i,f){case"log":this.log(a);break;case"debug":this.debug(a);break;case"warn":this.warn(a);break;case"info":this.info(a);break;case"error":this.error(a)}}(__indexOf.call(b.debug,"box")>=0||b.box)&&b.debugBox.state&&b.debugBox.logs&&b.debugBox.log("log",a)},window.console.log=_.bind(a,window.originalConsole,"log"),window.console.debug=_.bind(a,window.originalConsole,"debug"),window.console.warn=_.bind(a,window.originalConsole,"warn"),window.console.info=_.bind(a,window.originalConsole,"info"),window.console.error=_.bind(a,window.originalConsole,"error")},a.prototype.listeners=function(){var a,b;return b=this,this.onScroll=function(a){return $(window).on("AppOnScroll",function(b,c){return a?a(c):void 0})},a=0,$(window).scroll(function(c){var d,e,f;return e=b.scroll(),e!==a?(d=e>a?"down":"up",a=e,app.debugBox.state&&app.debugBox.log("scroll",""+d+" | top: "+e+"px"),f={top:e,action:d,e:c},$(window).trigger("AppOnScroll",[f])):void 0}),$(window).scroll(),this.onResize=function(a){return $(window).on("AppOnResize",function(b,c){return a?a(c):void 0})},$(window).resize(function(){return function(){var a;return a=app.size(),app.debugBox.state&&(app.debugBox.log("sect","header: "+a.headerHeight+"px | sections: "+a.sectionsHeight+"px | footer: "+a.footerHeight+"px"),app.debugBox.log("res",""+a.windowWidth+"px x "+a.windowHeight+"px")),$(window).trigger("AppOnResize",[a])}}(this)),$(window).resize()},a.prototype.scroll=function(a,b){var c,d,e,f;return f=(null!=b?b.time:void 0)||800,d=(null!=b?b.easing:void 0)||"easeOutCubic",c=!1,null!=a&&_.isString(a)?(e=$(a),e[0]&&_.isElement(e[0])?b?$("html,body").stop().animate({scrollTop:e.offset().top},f,d,function(){return!c&&(c=!0,b.done)?b.done():void 0}):$("html,body").scrollTop(e.offset().top):void 0):null!=a&&a[0]&&_.isElement(a[0])?b?$("html,body").stop().animate({scrollTop:a.offset().top},f,d,function(){return!c&&(c=!0,b.done)?b.done():void 0}):$("html,body").scrollTop(a.offset().top):null!=a?b?$("html,body").stop().animate({scrollTop:a},f,d,function(){return!c&&(c=!0,b.done)?b.done():void 0}):$("html,body").scrollTop(a):$(window).scrollTop()},a.prototype.size=function(){var a;return a={windowWidth:$(window).width(),windowHeight:$(window).height(),documentWidth:$(document).width(),documentHeight:$(document).height(),bodyWidth:parseInt($("body").width()),bodyHeight:parseInt($("body").height()),mainWidth:parseInt($("body > main").width()),mainHeight:parseInt($("body > main").height()),headerWidth:parseInt($("body > main > header").width()),headerHeight:parseInt($("body > main > header").height()),footerWidth:parseInt($("body > main > footer").width()),footerHeight:parseInt($("body > main > footer").height()),sectionsWidth:parseInt($("body > main > .sections").width()),sectionsHeight:parseInt($("body > main > .sections").height())}},a.prototype.routePrefix="!",a.prototype.redirect=function(a){return null==a&&(a=""),console.debug("[App > redirect]",a),window.location.hash==="#"+this.routePrefix+a&&this.router.navigate("redirect"),this.router.navigate(this.routePrefix+a,!0)},a.prototype.apiPrefix="",a.prototype.api=function(a,b,c,d){var e;return null==b&&(b="GET"),null==c&&(c={}),e=this.local?this.remoteHost:this.host,a=e+"/"+this.apiPrefix+a,$.ajax({type:b,dataType:"json",url:a,data:c}).done(function(){return function(e){var f;if(f=$$.browser.msie?JSON.stringify(e):e,"success"===e.status){if(e.data||(e.data=[]),console.debug("[App > api] "+a+" | "+b+":",c,"| success: ",f),d)return d(e.data)}else if("error"===e.status&&(console.error("[App > api] "+a+" | "+b+":",c,"| error: ",f),d))return d({error:e.error})}}(this)).fail(function(d){return function(e){var f;if(f=$$.browser.msie?JSON.stringify(e):e,console.error("[App > api] "+a+" | "+b+":",c,"| fail: ",f),4===e.readyState&&404===e.status){if(d.hashNavigate)return app.redirect("server-404")}else if(d.hashNavigate)return app.redirect("server-error")}}(this))},a.prototype.debugBox={logs:!0,state:!1,init:function(){return this.state=!0,$("body").append('<div id="debugBox" style="max-width: 400px;background:transparent;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#60000000,endColorstr=#60000000);background: rgba(0,0,0,0.6);position:fixed;z-index:10000; right:5px; bottom:5px;color:white; padding: 10px;">\n	DebugBox - '+app.name+'\n	<pre class="browser">browser: <span>'+$$.browser.name+" ver."+$$.browser.version+'</span></pre>\n	<pre class="res">resolution: <span></span></pre>\n	<pre class="scroll">scroll: <span>none</span></pre>\n	<pre class="route">route: <span>none</span></pre>\n	<pre class="sect"></pre>\n	<pre class="mediaHeight" style="color:red;"></pre>\n	<pre class="mediaWidth" style="color:red;"></pre>\n	<div class="log" style="margin-top: 10px; max-height: 80px;overflow-y:auto;word-wrap: break-word;"><div></div></div>\n</div>')},style:function(){var a;return a=$("#debugBox"),a.find(".log").css({color:"#85FF00"}).scrollTop(a.find(".log div").height()),a.find("pre,span").css({font:"14px monospace",padding:0,margin:0})},log:function(a,b){switch(a){case"log":$("#debugBox .log div").append("<pre>"+b+"</pre>\n<pre>------</pre>");break;case"sect":$("#debugBox .sect").html("<pre>"+b+"</pre>");break;case"res":$("#debugBox .res span").html(""+b);break;case"scroll":$("#debugBox .scroll span").html(""+b);break;case"route":$("#debugBox .route span").html(""+b)}return this.style()}},a.prototype.libs=function(){return $.support.cors=!0,$.ajaxSetup({cache:!1,crossDomain:!0})},a.prototype.social={vkontakteApiId:"",facebookApiId:"283793001782971",odnoklassnikiApiId:"",init:function(){return this.url=app.local?app.remoteHost:app.host},wallPost:{vkontakte:function(a){return null==a&&(a={}),"undefined"==typeof VK||null===VK?console.warn("[App > social > wallPost] VK is not defined"):(a.attachLink=a.attachLink?""+app.social.url+"#"+a.attachLink:app.social.url,a.attachPhoto=a.attachPhoto?a.attachPhoto:"photo131380871_321439116",VK.api("wall.post",{owner_id:a.owner_id,message:a.message,attachments:""+a.attachPhoto+","+a.attachLink},function(b){return!b||b.error?(console.error("[VKONTAKTE > wall.post]",b),a.error&&a.error(b.error),popup&&b.error&&b.error.error_msg&&b.error.error_code&&214===b.error.error_code&&app.errors.popup("Стенка закрыта",!1)):(console.debug("[VKONTAKTE > wall.post] success"),a.success&&a.success()),a.allways?a.allways():void 0}))},facebook:function(a){return null==a&&(a={}),"undefined"==typeof FB||null===FB?console.warn("[FB > social > wallPost] FB is not defined"):FB.ui({to:a.to,method:"feed",link:a.link||app.social.url,picture:a.picture||"",name:a.name||"",description:a.description||"",caption:a.caption||""},function(b){return b?(console.debug("[socWallPost Facebook] success"),a.success&&a.success()):(console.error("[socWallPost Facebook] error",b),a.error&&a.error()),a.allways?a.allways():void 0})},odnoklassniki:function(a){var b;return null==a&&(a={}),b=a.url||app.social.url,window.open("http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl="+encodeURIComponent(b)+"&st.comments="+encodeURIComponent(a.comments),"","toolbar=0,status=0,width=626,height=436")}},share:{it:function(){var a;return a={},a.title="title",a.description="description",a.image=""+app.host+"/img/for_post.png",this.facebook(a)},vk:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://vkontakte.ru/share.php?",b+="url="+encodeURIComponent(a.url),b+="&title="+encodeURIComponent(a.title),b+="&description="+encodeURIComponent(a.description),b+="&image="+encodeURIComponent(a.image),b+="&noparse=true",this.popup(b)},vkCount:function(a,b){var c;return a=a||app.social.url,c||(c={Share:{}}),c.Share.count=function(a,c){return b?b(c):void 0},$.getJSON("http://vkontakte.ru/share.php?act=count&index=1&url="+a+"&format=json&callback=?")},ok:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1",b+="&st.comments="+encodeURIComponent(a.description),b+="&st._surl="+encodeURIComponent(a.url),this.popup(b)},okCount:function(a,b){var c;return a=a||app.social.url,c||(c={}),c.updateCountOC=function(a,c){return b?b(c):void 0},$.getJSON("http://www.odnoklassniki.ru/dk?st.cmd=extOneClickLike&uid=odklocs0&callback=?&ref="+a)},fb:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://www.facebook.com/sharer.php?s=100",b+="&p[title]="+encodeURIComponent(a.title),b+="&p[summary]="+encodeURIComponent(a.description),b+="&p[url]="+encodeURIComponent(a.url),b+="&p[images][0]="+encodeURIComponent(a.image),this.popup(b)},fbCount:function(a,b){return a=a||app.social.url,$.getJSON("http://api.facebook.com/restserver.php?method=links.getStats&callback=?&urls="+escape(a)+"&format=json",function(a){return b?b(a[0].share_count):void 0})},tw:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://twitter.com/share?",b+="text="+encodeURIComponent(a.title),b+="&url="+encodeURIComponent(a.url),b+="&counturl="+encodeURIComponent(a.url),this.popup(b)},twCount:function(a,b){return a=a||app.social.url,$.getJSON("http://urls.api.twitter.com/1/urls/count.json?url="+a+"&callback=?",function(a){return b?b(a.count):void 0})},mailru:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://connect.mail.ru/share?",b+="url="+encodeURIComponent(a.url),b+="&title="+encodeURIComponent(a.title),b+="&description="+encodeURIComponent(a.description),b+="&imageurl="+encodeURIComponent(a.image),this.popup(b)},popup:function(a){return window.open(a,"","toolbar=0,status=0,width=626,height=436")}}},a.prototype.errors={popup:function(a,b){var c;return null==b&&(b=!0),c=b?this.get(a):a,popup.custom("Ошибка!",c)},get:function(a){var b;return $$.isObject(a)?(b="",_.each(a,function(a){return function(c){return c=a.rus[c]||c,b+=c+"<br/><br/>"}}(this))):b=this.rus[a],b||"Неизвестная ошибка"},rus:{"Story doesn't exist":"Истории не существует","User is not authenticated":"Юзер не авторизован"}},a}();