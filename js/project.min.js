var Models,PrototypeModel,UserModel,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};PrototypeModel=function(){function a(){this.fish=""===window.location.host||/localhost/.test(window.location.host)}return a.prototype.getFish=function(a,b,c,d){var e,f,g;return e=JSON.stringify(c),f=$.parseJSON(e),g=f.data||[],console.warn("[WARNING Api FISH!]",a,"| request:",b,"| response:",g),d(g)},a}(),UserModel=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.getRes={data:{age:31,avatar:"http://cs607518.vk.me/v607518871/1b51/MLpE9yqMzOg.jpg",birthday:"1983-01-19",city:"Москва",country:"Россия",firstname:"Vins",gender:"male",uid:131380871,lastname:"Surfer"},status:"success"},b.prototype.get=function(a,b){var c;return c="user/details",this.fish?this.getFish(c,a,this.getRes,b):app.api(c,"GET",a,function(a){return b(a)})},b}(PrototypeModel),Models=function(){function a(){this.user=new UserModel}return a}();var IndexView,PrototypeView,Views,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};PrototypeView=function(){function a(){var a=this;this.varconstants={},this.doResize(),$(window).resize(function(){return a.doResize()}),this.init()}return a.prototype.render_debug=!0,a.prototype.generateRenders=function(a){var b=this;return null==a&&(a=this.template),_.each(a,function(a,c){return b.templateSourse||(b.templateSourse={}),b.templateSourse[c]=$.trim(a.html()),b.render||(b.render={}),b.render[c]=function(){return b.doRender(c,b.template[c],b.templateSourse[c])},b.preRender||(b.preRender={}),b.preRender[c]=function(a){return null==a&&(a={}),b.doPreRender(c,b.template[c],a)}}),this.renderAll=function(){return _.each(a,function(a,c){return b.render[c]()})}},a.prototype.doPreRender=function(a,b,c){var d,e,f,g,h,i;try{return d=c&&c.c?c.c:"#000",g=c&&c.t?c.t:!1,i=c&&c.w?parseInt(c.w)+"px":"auto",f=c&&c.h?parseInt(c.h)+"px":"100px",h=c&&c.m?parseInt(c.m)+"px":parseInt(f)/2-10+"px",this.render_debug&&console.log("[preRender "+a+"] loadtext:",g),g?b.html('<div class="prerender" style="position:relative;height:'+f+";width:"+i+';text-align:center;">\n	<p style="position: relative; top:'+h+"; color:"+d+'">'+g+"</p>\n</div>"):b.empty()}catch(j){return e=j,console.error("[preRender] template undefined"),console.error(e)}},a.prototype.doRender=function(a,b,c,d){return null==d&&(d=this.vars),this.render_debug&&console.log("[Render "+a+"]","| @vars:",d),b.html(Mustache.to_html(c,d))},a.prototype.doResize=function(){var a,b,c;return this.sections={el:$("body > main > .sections")},b=parseInt($("body > main > header").height()),a=parseInt($("body > main > footer").height()),c=parseInt($("body > main > .sections").height()),app.debugBox.log("sect","header: "+b+"px | sections: "+c+"px | footer: "+a+"px"),app.debugBox.log("res",""+$(window).width()+"px x "+$(window).height()+"px"),this.resize()},a.prototype.resize=function(){},a.prototype.init=function(){},a.prototype.controller=function(a){this.opt=null!=a?a:{}},a.prototype.actions=function(){},a.prototype.doImage=function(a,b){var c;return null==b&&(b=""),a&&""!==a?(/http:\/\//.test(a)||(a=app.host+a),c='<img src="'+a+'" class="'+b+'" >'):void 0},a}(),IndexView=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.init=function(){return this.el=$("index"),this.template={example:this.el.find(".example")},this.generateRenders()},b.prototype.controller=function(a){var b=this;return this.opt=null!=a?a:{},this.vars={},this.preRender.example({t:"Load...",h:130}),app.models.user.get({},function(a){return a.error?app.errors.popup(a.error):b.renderResponse(a)})},b.prototype.renderResponse=function(a){return _.extend(this.vars,this.varconstants),_.extend(this.vars,a),this.vars.avatar&&this.doImage(this.vars.avatar),this.render.example(),this.actions()},b}(PrototypeView),Views=function(){function a(){this.index=new IndexView}return a}();var Router,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Router=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.routes={"":"index","!":"index","!/":"index","!/page/:id":"page","!/page/:id/":"page","!/ooops":"ooops","!/ooops/":"ooops","*path":"notFound"},b.prototype.initialize=function(){return this.bind("all",function(){})},b.prototype.before=function(a){return""!==a&&console.debug("[Route]",a),this.hide(),"undefined"!=typeof VK&&null!==VK?VK.callMethod("setLocation",a.replace("!","")):void 0},b.prototype.after=function(){},b.prototype.hide=function(){return $("body > main > .sections section").removeClass("current").hide()},b.prototype.show=function(a){return a.addClass("current").show()},b.prototype.scrollTop=function(a){if(null==a&&(a=400),a){if($("html,body").animate({scrollTop:0},a),"undefined"!=typeof VK&&null!==VK)return VK.callMethod("scrollWindow",0,a)}else if($("body").scrollTop(0),"undefined"!=typeof VK&&null!==VK)return VK.callMethod("scrollWindow",0)},b.prototype.notFound=function(){var a;return a=$("section#notFound"),this.scrollTop(),this.show(a)},b.prototype.ooops=function(){var a;return a=$("section#notFound"),this.scrollTop(),this.show(a)},b.prototype.index=function(){var a;return a=$("section#index"),this.scrollTop(),this.show(a)},b.prototype.page=function(){var a;return a=$("section#page"),this.scrollTop(),this.show(a)},b}(Backbone.Router);var App,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};App=function(){function a(){var a;this.localhost=""===window.location.host||/localhost/.test(window.location.host),this.host=this.localhost?"http://vinsproduction.com":"http://"+window.location.host,this.root="",this.debug=function(){var a;return a=$$.urlParam("debug"),a?a.split(","):[]}(),!$$.browser.msie&&this.localhost&&(a=777,$$.includeJS("http://localhost:"+a+"/livereload.js"),console.debug("[Livereload] http://localhost:"+a+"/livereload.js")),$$.browser.msie6||$$.browser.msie7||this.libs()}return a.prototype.ver="3.0",a.prototype.name="Frontend Skeleton",a.prototype.hashNavigate=!1,a.prototype.init=function(){var a=this;return $(function(){return __indexOf.call(a.debug,"box")>=0&&a.debugBox.init(),Models&&(a.models=new Models),Views&&(a.views=new Views),a.hashNavigate&&(a.router=new Router,Backbone.history.start()),a.social.init(),console.debug("[App::init] debug:",a.debug,a)})},a.prototype.redirect=function(a){return null==a&&(a=""),console.debug("[app > redirect]",a),window.location.hash==="#!"+a&&this.router.navigate("!/redirect"),this.router.navigate("!"+a,!0)},a.prototype.api_prefix="",a.prototype.api=function(a,b,c,d){var e=this;return null==b&&(b="GET"),null==c&&(c={}),a=app.host+this.api_prefix+a,$.ajax({type:b,url:a,data:c}).done(function(e){var f;if(f=$$.browser.msie?JSON.stringify(e):e,"success"===e.status){if(e.data||(e.data=[]),console.debug("[Api] "+a+" | "+b+":",c,"| success: ",f),d)return d(e.data)}else if("error"===e.status&&(console.error("[Api] "+a+" | "+b+":",c,"| error: ",f),d))return d({error:e.error})}).fail(function(d){var f;if(f=$$.browser.msie?JSON.stringify(d):d,console.error("[Api] "+a+" | "+b+":",c,"| fail: ",f),4===d.readyState&&404===d.status){if(e.hashNavigate)return app.redirect("/404")}else if(e.hashNavigate)return app.redirect("/ooops")})},a.prototype.debugBox={init:function(){return $("body").append('<div id="debugBox" style="font-size: 14px;background: rgba(0,0,0,0.6);position:fixed;z-index:10000; right:5px; bottom:5px;color:white; padding: 10px;">\n	debug box\n	<pre class="res">resolution: <span></span></pre>\n	<div class="sect"></div>\n	<div class="log"></div>\n	<pre class="mediaHeight" style="color:red;"></pre>\n	<pre class="mediaWidth" style="color:red;"></pre>\n</div>')},color:function(){return $("#debugBox").find(".log pre:nth-child(2n)").css({color:"gray"})},log:function(a,b){return"log"===a?$("#debugBox .log").append("<pre>"+b+"</pre>"):"sect"===a?$("#debugBox .sect").html("<pre>"+b+"</pre>"):"res"===a&&$("#debugBox .res span").html(""+b),app.debugBox.color()}},a.prototype.libs=function(){return jQuery.support.cors=!0,jQuery.ajaxSetup({cache:!1,crossDomain:!0})},a.prototype.social={url:"",vkontakteApiId:"",facebookApiId:"",odnoklassnikiApiId:"",init:function(){return app.social.url=this.host},wallPost:{vkontakte:function(a){return null==a&&(a={}),"undefined"==typeof VK||null===VK?console.warn("[App > social > wallPost] VK is not defined"):(a.attachLink=a.attachLink?""+app.social.url+"#"+a.attachLink:app.social.url,a.attachPhoto=a.attachPhoto?a.attachPhoto:"photo131380871_321439116",VK.api("wall.post",{owner_id:a.owner_id,message:a.message,attachments:""+a.attachPhoto+","+a.attachLink},function(b){return!b||b.error?(console.error("[VKONTAKTE > wall.post]",b),a.error&&a.error(b.error),popup&&b.error&&b.error.error_msg&&b.error.error_code&&214===b.error.error_code&&app.errors.popup("Стенка закрыта",!1)):(console.debug("[VKONTAKTE > wall.post] success"),a.success&&a.success()),a.allways?a.allways():void 0}))},facebook:function(a){return null==a&&(a={}),"undefined"==typeof FB||null===FB?console.warn("[FB > social > wallPost] FB is not defined"):FB.ui({to:a.to,method:"feed",link:a.link||app.social.url,picture:a.picture||"",name:a.name||"",description:a.description||"",caption:a.caption||""},function(b){return b?(console.debug("[socWallPost Facebook] success"),a.success&&a.success()):(console.error("[socWallPost Facebook] error",b),a.error&&a.error()),a.allways?a.allways():void 0})},odnoklassniki:function(a){var b;return null==a&&(a={}),b=a.url||app.social.url,window.open("http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl="+encodeURIComponent(b)+"&st.comments="+encodeURIComponent(a.comments),"","toolbar=0,status=0,width=626,height=436")}},share:{itVk:function(){var a;return a={},a.title="title",a.description="description",a.url=app.social.url,a.image=""+app.host+"/img/for_post.png"},vkontakte:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://vkontakte.ru/share.php?",b+="url="+encodeURIComponent(a.url),b+="&title="+encodeURIComponent(a.title),b+="&description="+encodeURIComponent(a.description),b+="&image="+encodeURIComponent(a.image),b+="&noparse=true",this.popup(b)},odnoklassniki:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1",b+="&st.comments="+encodeURIComponent(a.description),b+="&st._surl="+encodeURIComponent(a.url),this.popup(b)},facebook:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://www.facebook.com/sharer.php?s=100",b+="&p[title]="+encodeURIComponent(a.title),b+="&p[summary]="+encodeURIComponent(a.description),b+="&p[url]="+encodeURIComponent(a.url),b+="&p[images][0]="+encodeURIComponent(a.image),this.popup(b)},twitter:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://twitter.com/share?",b+="text="+encodeURIComponent(a.title),b+="&url="+encodeURIComponent(a.url),b+="&counturl="+encodeURIComponent(a.url),this.popup(b)},mailru:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://connect.mail.ru/share?",b+="url="+encodeURIComponent(a.url),b+="&title="+encodeURIComponent(a.title),b+="&description="+encodeURIComponent(a.description),b+="&imageurl="+encodeURIComponent(a.image),this.popup(b)},popup:function(a){return window.open(a,"","toolbar=0,status=0,width=626,height=436")}}},a.prototype.errors={popup:function(a,b){var c;return null==b&&(b=!0),c=b?this.get(a):a,popup.custom("Ошибка!",c)},get:function(a){var b,c=this;return $$.isObject(a)?(b="",_.each(a,function(a){return a=c.rus[a]||a,b+=a+"<br/><br/>"})):b=this.rus[a],b||"Неизвестная ошибка"},rus:{"Story doesn't exist":"Истории не существует","User is not authenticated":"Юзер не авторизован"}},a}();