var Models,PrototypeModel,UserModel,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};PrototypeModel=function(){function a(){this.fish=""===window.location.host||/localhost/.test(window.location.host)}return a.prototype.getFish=function(a,b,c,d){var e,f,g;return e=JSON.stringify(c),f=$.parseJSON(e),g=f.data||[],console.warn("[WARNING Api FISH!]",a,"| request:",b,"| response:",g),d(g)},a}(),UserModel=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.getRes={data:{age:31,avatar:"http://cs5474.vk.me/u1748598/-14/x_97fe02f9.jpg",birthday:"1983-01-19",city:"Москва",country:"Россия",firstname:"Vins",gender:"male",id:1,lastname:"Production"},status:"success"},b.prototype.get=function(a,b){var c;return c="user/details",this.fish?this.getFish(c,a,this.getRes,b):app.api(c,"GET",a,function(a){return b(a)})},b}(PrototypeModel),Models=function(){function a(){this.user=new UserModel}return a}();var IndexView,PrototypeView,Views,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};PrototypeView=function(){function a(){var a=this;this.varconstants={},this.doResize(),$(window).resize(function(){return a.doResize()}),this.init()}return a.prototype.render_debug=!0,a.prototype.generateRenders=function(a){var b=this;return null==a&&(a=this.template),_.each(a,function(a,c){return b.templateSourse||(b.templateSourse={}),b.templateSourse[c]=$.trim(a.html()),b.render||(b.render={}),b.render[c]=function(){return b.doRender(c,b.template[c],b.templateSourse[c])},b.preRender||(b.preRender={}),b.preRender[c]=function(a){return null==a&&(a={}),b.doPreRender(c,b.template[c],a)}}),this.renderAll=function(){return _.each(a,function(a,c){return b.render[c]()})}},a.prototype.doPreRender=function(a,b,c){var d,e,f,g,h;try{return f=c&&c.t?c.t:!1,h=c&&c.w?parseInt(c.w)+"px":"auto",e=c&&c.h?parseInt(c.h)+"px":"100px",g=c&&c.m?parseInt(c.m)+"px":parseInt(e)/2-10+"px",this.render_debug&&console.log("[preRender "+a+"] loadtext:",f),f?b.html('<div class="prerender" style="position:relative;height:'+e+";width:"+h+';text-align:center;">\n	<p style="position: relative; top:'+g+'; color:#FFF">'+f+"</p>\n</div>"):b.empty()}catch(i){return d=i,console.error("[preRender] template undefined"),console.error(d)}},a.prototype.doRender=function(a,b,c,d){return null==d&&(d=this.vars),this.render_debug&&console.log("[Render "+a+"]","| @vars:",d),b.removeAttr("style").html(Mustache.to_html(c,d))},a.prototype.doResize=function(){var a,b,c;return this.sections={el:$("body > main > .sections")},b=parseInt($("body > main > header").height()),a=parseInt($("body > main > footer").height()),c=parseInt($("body > main > .sections").height()),app.debugBox.log("sect","header: "+b+"px | sections: "+c+"px | footer: "+a+"px"),app.debugBox.log("res",""+$(window).width()+"px x "+$(window).height()+"px"),this.resize()},a.prototype.resize=function(){},a.prototype.init=function(){},a.prototype.controller=function(a){this.opt=null!=a?a:{}},a.prototype.actions=function(){},a}(),IndexView=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.init=function(){return this.el=$("section#test-render"),this.template={content:this.el.find(".content")},this.generateRenders()},b.prototype.controller=function(a){var b=this;return this.opt=null!=a?a:{},this.vars={},this.preRender.content({t:"Load...",h:130}),app.models.user.get({},function(a){return a.error?app.errors.popup(a.error):b.renderResponse(a)})},b.prototype.renderResponse=function(a){return _.extend(this.vars,this.varconstants),_.extend(this.vars,a),this.vars.avatar=this.vars.avatar?'<img src="'+this.vars.avatar+'"" class="ava">':"",this.render.content(),this.actions()},b}(PrototypeView),Views=function(){function a(){this.index=new IndexView}return a}();var AppRouter,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Backbone.Router.prototype.before=function(){},Backbone.Router.prototype.after=function(){},Backbone.Router.prototype.route=function(a,b,c){var d;return _.isRegExp(a)||(a=this._routeToRegExp(a)),_.isFunction(b)&&(c=b,b=""),c||(c=this[b]),d=this,Backbone.history.route(a,function(e){var f;return f=d._extractParameters(a,e),d.before.apply(d,arguments),c&&c.apply(d,f),d.after.apply(d,arguments),d.trigger.apply(d,["route:"+b].concat(f)),d.trigger("route",b,f),Backbone.history.trigger("route",d,b,f)})},AppRouter=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.routes={"":"index","!":"index","!/":"index","!/ooops":"ooops","!/ooops/":"ooops","*path":"notFound"},b.prototype.before=function(a){return""!==a&&console.debug("[Route]",a),$("body").scrollTop(0)},b.prototype.after=function(){},b.prototype.initialize=function(){return this.bind("all",function(){})},b.prototype.notFound=function(){return $("section#notFound").show()},b.prototype.ooops=function(){return $("section#ooops").show()},b.prototype.index=function(){return $("section#index").show(),app.views.index.controller()},b}(Backbone.Router);var App,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};App=function(){function a(a){var b;null==a&&(a={}),this.name="Frontend Skeleton",this.localhost=""===window.location.host||/localhost/.test(window.location.host),this.host=this.localhost?"http://vinsproduction.com":"http://"+window.location.host,this.root=a.root||"",this.debug=function(){var a;return a=$$.urlParam("debug"),a?a.split(","):[]}(),!$$.browser.msie&&this.localhost&&(b=777,$$.includeJS("http://localhost:"+b+"/livereload.js"),console.debug("[Livereload] http://localhost:"+b+"/livereload.js")),$$.browser.msie6||$$.browser.msie7||this.libs()}return a.prototype.init=function(){var a=this;return $(function(){return __indexOf.call(a.debug,"box")>=0&&a.debugBox.init(),Models&&(a.models=new Models),Views&&(a.views=new Views),a.router=new AppRouter,Backbone.history.start(),a.social.init(),console.debug("[App::init] debug:",a.debug,a)})},a.prototype.redirect=function(a){return null==a&&(a=""),this.router.navigate("!"+a,!0)},a.prototype.api=function(a,b,c,d){var e;return null==b&&(b="GET"),null==c&&(c={}),e="/api/v1/",a=app.host+e+a,$.ajax({type:b,url:a,data:c}).done(function(e){var f;if(f=$$.browser.msie?JSON.stringify(e):e,"success"===e.status){if(e.data||(e.data=[]),console.debug("[Api] "+a+" | "+b+":",c,"| success: ",f),d)return d(e.data)}else if("error"===e.status&&(console.error("[Api] "+a+" | "+b+":",c,"| error: ",f),d))return d({error:e.error})}).fail(function(d){var e;return e=$$.browser.msie?JSON.stringify(d):d,console.error("[Api] "+a+" | "+b+":",c,"| fail: ",e),app.redirect(4===d.readyState&&404===d.status?"/404":"/ooops")})},a.prototype.debugBox={init:function(){return $("body").append('<div id="debugBox" style="font-size: 14px;background: rgba(0,0,0,0.6);position:fixed;z-index:10000; right:5px; bottom:5px;color:white; padding: 10px;">\n	debug box\n	<pre class="res">resolution: <span></span></pre>\n	<div class="sect"></div>\n	<div class="log"></div>\n	<pre class="mediaHeight" style="color:red;"></pre>\n	<pre class="mediaWidth" style="color:red;"></pre>\n</div>')},color:function(){return $("#debugBox").find(".log pre:nth-child(2n)").css({color:"gray"})},log:function(a,b){return"log"===a?$("#debugBox .log").append("<pre>"+b+"</pre>"):"sect"===a?$("#debugBox .sect").html("<pre>"+b+"</pre>"):"res"===a&&$("#debugBox .res span").html(""+b),app.debugBox.color()}},a.prototype.libs=function(){return jQuery.support.cors=!0,jQuery.ajaxSetup({cache:!1,crossDomain:!0})},a.prototype.social={defaults:{vkontakteApiId:"",facebookApiId:"",odnoklassnikiApiId:""},init:function(){var a;return a=function(){return app.social.url=this.host,VK&&VK.init({apiId:app.social.vkontakteApiId}),FB?FB.init({appId:app.social.facebookApiId,status:!0,cookie:!0,xfbml:!0,oauth:!0}):void 0}},wallPost:{vkontakte:function(a){return null==a&&(a={}),VK.api("wall.post",{owner_id:a.owner_id,message:a.message},function(b){return!b||b.error?(console.error("[socWallPost Vkontakte] error",b),a.error&&a.error()):(console.debug("[socWallPost Vkontakte] success"),a.success&&a.success()),a.allways?a.allways():void 0})},facebook:function(a){return null==a&&(a={}),FB.ui({to:a.to,method:"feed",link:a.link||app.social.url,picture:a.picture||"",name:a.name||"",description:a.description||"",caption:a.caption||""},function(b){return b?(console.debug("[socWallPost Facebook] success"),a.success&&a.success()):(console.error("[socWallPost Facebook] error",b),a.error&&a.error()),a.allways?a.allways():void 0})},odnoklassniki:function(a){var b;return null==a&&(a={}),b=a.url||app.social.url,window.open("http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl="+encodeURIComponent(b)+"&st.comments="+encodeURIComponent(a.comments),"","toolbar=0,status=0,width=626,height=436")}},share:{vkontakte:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://vkontakte.ru/share.php?",b+="url="+encodeURIComponent(a.url),b+="&title="+encodeURIComponent(a.title),b+="&description="+encodeURIComponent(a.text),b+="&image="+encodeURIComponent(a.img),b+="&noparse=true",this.popup(b)},odnoklassniki:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1",b+="&st.comments="+encodeURIComponent(a.text),b+="&st._surl="+encodeURIComponent(a.url),this.popup(b)},facebook:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://www.facebook.com/sharer.php?s=100",b+="&p[title]="+encodeURIComponent(a.title),b+="&p[summary]="+encodeURIComponent(a.text),b+="&p[url]="+encodeURIComponent(a.url),b+="&p[images][0]="+encodeURIComponent(a.img),this.popup(b)},twitter:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://twitter.com/share?",b+="text="+encodeURIComponent(a.title),b+="&url="+encodeURIComponent(a.url),b+="&counturl="+encodeURIComponent(a.url),this.popup(b)},mailru:function(a){var b;return null==a&&(a={}),a.url=a.url||app.social.url,b="http://connect.mail.ru/share?",b+="url="+encodeURIComponent(a.url),b+="&title="+encodeURIComponent(a.title),b+="&description="+encodeURIComponent(a.text),b+="&imageurl="+encodeURIComponent(a.img),this.popup(b)},popup:function(a){return window.open(a,"","toolbar=0,status=0,width=626,height=436")}}},a.prototype.errors={popup:function(a){var b;return b=this.get(a),popup.custom("Ошибка!",b)},get:function(a){var b,c=this;return $$.isObject(a)?(b="",_.each(a,function(a){return a=c.rus[a]||a,b+=a+"<br/><br/>"})):b=this.rus[a],b||"Неизвестная ошибка"},rus:{"Story doesn't exist":"Истории не существует","User is not authenticated":"Юзер не авторизован"}},a}();